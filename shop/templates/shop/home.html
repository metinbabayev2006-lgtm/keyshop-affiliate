{% extends "shop/base.html" %}
{% load static %}

{% block title %}KeyShop • Digitale Codes{% endblock %}

{% block content %}

<section class="hero">
  <h1>
    {% if current_category %}
      {{ current_category.name }}
    {% else %}
      Digitale Codes
    {% endif %}
  </h1>
  <p class="muted">Du wirst zum Anbieter weitergeleitet (Affiliate).</p>

  <div class="ptags" style="margin-top:14px">
    <a class="btn btn--primary" href="#products">Jetzt ansehen</a>
    <a class="btn btn--ghost" href="{% url 'shop:kontakt' %}">Kontakt</a>
  </div>
</section>

{% comment %} MINI-GUIDES (Awin-ready) {% endcomment %}

<section style="margin-top:16px;">
  <details class="panel prose" style="cursor:pointer;">
    <summary style="list-style:none; display:flex; align-items:center; justify-content:space-between; gap:12px;">
      <div>
        <strong>Mini-Guide anzeigen</strong>
        <div class="muted small">
          Tipps zu Region, Laufzeit und Einlösung (Awin-ready).
        </div>
      </div>
      <span class="muted small">▼</span>
    </summary>

    <div style="margin-top:12px;">
      {% if current_category %}
        {% if current_category.slug == "steam" %}
          <h2 class="strong">Steam Guthaben: Worauf achten?</h2>
          <p>
            Steam Guthaben ist praktisch, wenn du Spiele, DLCs oder In-Game-Inhalte direkt über Steam kaufen willst.
            Beim Kauf eines Codes ist der wichtigste Punkt die <strong>Region</strong>. Viele Angebote sind für ein bestimmtes
            Land oder eine bestimmte Region gedacht (z.B. Deutschland/EU). Wenn dein Steam-Account in einer anderen Region
            registriert ist, kann es sein, dass der Code nicht einlösbar ist oder nur eingeschränkt funktioniert.
          </p>
          <p>
            Achte außerdem auf den <strong>Betrag</strong> (z.B. 10 €, 20 €, 50 €) und lies vor dem Kauf die Hinweise des Anbieters.
            Manche Anbieter verwenden unterschiedliche Bezeichnungen, entscheidend sind Region und Einlösebedingungen.
          </p>
          <p>
            <strong>Einlösung:</strong> In Steam gehst du auf „Spiele“ → „Einen Steam-Guthabencode einlösen“ (Wallet aufladen).
            Nach der Einlösung wird das Guthaben deinem Konto gutgeschrieben.
          </p>
          <p class="muted small">
            Hinweis: Wir verkaufen nichts direkt. Beim Klick auf „Zum Anbieter“ wirst du weitergeleitet (Affiliate).
          </p>

        {% elif current_category.slug == "playstation" %}
          <h2 class="strong">PlayStation Guthaben: Region & Einlösung</h2>
          <p>
            PlayStation Store Guthaben (PSN) ist an die <strong>Region</strong> deines PlayStation-Kontos gebunden.
            Ein Code für Deutschland funktioniert normalerweise nur mit einem deutschen Konto. Prüfe Region und Hinweise
            beim Anbieter vor dem Kauf.
          </p>
          <p>
            <strong>Einlösung:</strong> PlayStation Store → „Codes einlösen“ → Code eingeben.
            Danach wird der Betrag als Guthaben angezeigt.
          </p>
          <p class="muted small">
            Hinweis: Wir verkaufen nichts direkt. Beim Klick auf „Zum Anbieter“ wirst du weitergeleitet (Affiliate).
          </p>

        {% elif current_category.slug == "spotify" %}
          <h2 class="strong">Spotify Premium: Laufzeit, Aktivierung, Unterschiede</h2>
          <p>
            Spotify Premium gibt es oft als Code mit bestimmter <strong>Laufzeit</strong> (1/3/6/12 Monate).
            Achte auf die genaue Laufzeit und die Aktivierungsbedingungen (manche Angebote gelten nur für bestimmte Konten).
          </p>
          <p>
            Prüfe außerdem die <strong>Region</strong>. Einige Codes sind nur in bestimmten Ländern einlösbar (z.B. DE/EU).
            Preise und Bedingungen stehen immer beim Anbieter.
          </p>
          <p class="muted small">
            Hinweis: Wir verkaufen nichts direkt. Beim Klick auf „Zum Anbieter“ wirst du weitergeleitet (Affiliate).
          </p>

        {% elif current_category.slug == "youtube-premium" %}
          <h2 class="strong">YouTube Premium: Vorteile & Laufzeit</h2>
          <p>
            YouTube Premium bietet normalerweise werbefreies Schauen und oft YouTube Music.
            Angebote unterscheiden sich vor allem bei der <strong>Laufzeit</strong> (1/3/6/12 Monate) und manchmal bei der Region.
          </p>
          <p>
            Achte auf die <strong>Region</strong> und die Aktivierungs-Hinweise beim Anbieter.
            Aktivierung erfolgt meist über dein Google-Konto.
          </p>
          <p class="muted small">
            Hinweis: Wir verkaufen nichts direkt. Beim Klick auf „Zum Anbieter“ wirst du weitergeleitet (Affiliate).
          </p>

        {% else %}
          <h2 class="strong">Hinweis</h2>
          <p>
            Wir vergleichen digitale Angebote und leiten dich bei Klick zu externen Anbietern weiter.
            Achte bei digitalen Codes besonders auf Region, Laufzeit und Einlösebedingungen.
          </p>
        {% endif %}
      {% else %}
        <h2 class="strong">So funktioniert KeyShop</h2>
        <p>
          KeyShop ist ein Vergleichsprojekt für digitale Codes (z.B. Guthaben und Abos).
          Du kannst Produkte nach Kategorie, Preis, Name und Region filtern.
          Beim Klick auf „Zum Anbieter“ wirst du zu einem externen Anbieter weitergeleitet.
          Wenn du dort etwas kaufst, können wir eine Provision erhalten.
        </p>
        <p class="muted small">
          Hinweis: Wir verkaufen nichts direkt und führen keine Zahlungen über diese Website durch.
        </p>
      {% endif %}
    </div>
  </details>
</section>


<section class="toolbar">
  <form class="toolbar__form" method="get">
    <div class="search">
      <input
        type="text"
        name="q"
        placeholder="Suchen (z.B. Fortnite, Spotify...)"
        value="{{ q|default:'' }}"
        autocomplete="off"
      />
      <button class="btn btn--ghost" type="submit">Suchen</button>
    </div>

    <div class="filters">
      <select name="sort" class="select" onchange="this.form.submit()">
        <option value="">Sortieren</option>
        <option value="price_asc" {% if sort == "price_asc" %}selected{% endif %}>Preis: günstig → teuer</option>
        <option value="price_desc" {% if sort == "price_desc" %}selected{% endif %}>Preis: teuer → günstig</option>
        <option value="name_asc" {% if sort == "name_asc" %}selected{% endif %}>Name: A → Z</option>
      </select>

      <select name="region" class="select" onchange="this.form.submit()">
        <option value="">Region</option>
        <option value="DE" {% if region == "DE" %}selected{% endif %}>Deutschland</option>
        <option value="EU" {% if region == "EU" %}selected{% endif %}>Europa</option>
        <option value="GLOBAL" {% if region == "GLOBAL" %}selected{% endif %}>Weltweit</option>
      </select>

      <a class="btn btn--ghost"
         href="{% if current_category %}{% url 'shop:category' current_category.slug %}{% else %}{% url 'shop:home' %}{% endif %}">
        Reset
      </a>
    </div>
  </form>
</section>

<section id="products" class="grid">
  {% for p in products %}
    {% url 'shop:product_detail' p.pk as detail_url %}
    {% url 'shop:affiliate_go' p.pk as go_url %}

    <article class="card card--product">
      <!-- whole card -> detail page -->
      <a class="cardlink cardlink--full"
         href="{{ detail_url }}"
         aria-label="{{ p.name }}">
      </a>

      <div class="pimg">
        <img
          src="{% static 'shop/icons/' %}{{ p.icon_key|default:'default' }}.svg"
          alt=""
          width="44"
          height="44"
          loading="lazy"
        />
      </div>

      <div class="pinfo">
        <div class="ptags">
          <span class="badge">Digital Code</span>
          <span class="badge badge--soft">Region: {{ p.region|default:"—" }}</span>
        </div>

        <h3 class="card__title">
          <a href="{{ detail_url }}" class="card__link">
            {{ p.name }}
          </a>
        </h3>

        <p class="muted small">
          {{ p.description|default:"Digitaler Code / Key" }}
        </p>

        <div class="prow">
          <div class="price">
            {% if p.price_eur %}
              {{ p.price_eur }} €
            {% else %}
              <span class="muted">Preis beim Anbieter</span>
            {% endif %}
          </div>

          {% if p.affiliate_url %}
            <!-- button -> provider -->
            <a class="btn btn--primary"
               href="{{ go_url }}"
               target="_blank"
               rel="nofollow sponsored">
              Zum Anbieter
            </a>
          {% else %}
            <a class="btn btn--ghost" href="{{ detail_url }}">Details</a>
          {% endif %}
        </div>
      </div>
    </article>

  {% empty %}
    <p class="muted">Keine Produkte gefunden.</p>
  {% endfor %}
</section>

{% endblock %}
